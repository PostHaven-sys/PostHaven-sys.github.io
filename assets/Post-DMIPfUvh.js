import{_ as W,i as k,r as d,w as F,o as X,j as p,a as m,l as h,C as E,b as i,n as l,u as t,d as z,I,g as S,t as O,A as L,R,f as M,h as y}from"./index-BofsLPDd.js";const Y={class:"like_and_comment"},Z=["disabled"],ee={key:3,class:"loader"},te={key:1,class:"loader"},se={class:"post_description"},oe={class:"post_text"},ie={class:"user_and_other"},le={class:"user"},ne={class:"logo"},ae={class:"logo_name"},ue={class:"other"},re={key:0,class:"loader"},ce={key:1},de=["disabled"],pe=["disabled"],ve={__name:"Post",props:{postOption:{type:Object,return:!0},userOption:{type:Object,return:!0},subDis:Boolean,otherDis:Boolean},setup(s){const _=s,a=k("theme"),b=k("confirmation"),v=k("user_Id"),w=k("urlAdressAuth"),U=k("urlAdressPosts"),B=k("commentId"),q=k("updateSub"),C=d(!1),r=d(!1),A=d(null),T=d(!1),D=d(!1),c=d(null),x=d(),$=d([]),g=d([]),P=d(!1),G=async(n,e,u)=>{r.value=!0;try{if(!v){console.error("UserId не найден в localStorage"),r.value=!1;return}const o=await y.get(`${w}?user_id=${v}`);if(!o.data||!o.data[0]){console.error("Данные пользователя не найдены"),r.value=!1;return}$.value=o.data[0].post_like;const N=$.value.findIndex(f=>f===u);if(N!==-1){$.value.splice(N,1),x.value=e,x.value--,c.value=null;try{const f=await y.put(`${w}/${o.data[0].id}`,{post_like:$.value})}catch(f){console.error("Ошибка при обновлении данных:",f),r.value=!1}}else{$.value.push(u),x.value=e,x.value++,c.value=null;try{const f=await y.put(`${w}/${o.data[0].id}`,{post_like:$.value})}catch(f){console.error("Ошибка при обновлении данных:",f),r.value=!1}}}catch(o){console.error("Ошибка при получении данных пользователя:",o),r.value=!1}try{const o=await y.put(`${U}/${n}`,{like:x.value});r.value=!1,o.status==200&&(b.value.subscribe=!0)}catch(o){console.log(o),r.value=!1}},H=async n=>{D.value=!0;try{if(!v){console.error("UserId не найден в localStorage");return}const e=await y.get(`${w}?user_id=${v}`);if(!e.data||!e.data[0]){console.error("Данные пользователя не найдены");return}g.value=e.data[0].users_subsribe;const u=g.value.findIndex(o=>o===n);if(u!==-1){g.value.splice(u,1);try{const o=await y.put(`${w}/${e.data[0].id}`,{users_subsribe:g.value});g.value=[]}catch(o){console.error("Ошибка при обновлении данных:",o)}}else{g.value.push(n);try{const o=await y.put(`${w}/${e.data[0].id}`,{users_subsribe:g.value});g.value=[]}catch(o){console.error("Ошибка при обновлении данных:",o)}}b.value.subscribe=!0,b.value.subId=_.postOption.image_id}catch(e){console.error("Ошибка при получении данных пользователя:",e)}},V=n=>{const e=_.userOption.post_like.includes(n.image_id);C.value=e,c.value=n.like,A.value=n.comment.length},j=()=>{const n=_.userOption.users_subsribe.includes(_.postOption.user_id);T.value=n,D.value=!1,b.value.subscribe=!1},J=(n,e)=>{B.value.id=n,B.value.uId=e},K=()=>{P.value=!P.value},Q=n=>{b.value.id=n,b.value.deletePost=!0,b.value.active=!0};return F(()=>{q.value===!0&&(j(),V(_.postOption))}),F(()=>{B.value.uId===_.postOption.user_id&&B.value.id===null&&(b.value.subscribe=!0)}),X(()=>{V(_.postOption),j()}),(n,e)=>(p(),m("section",{class:l(["post_container",t(a)?"themeBgwhite":"themeBgblack"])},[h(E,{src:s.postOption.image,style:{"border-radius":"30px",overflow:"hidden"}},null,8,["src"]),i("div",Y,[i("button",{onClick:e[0]||(e[0]=u=>G(s.postOption.id,c.value,s.postOption.image_id)),class:l(["like",t(a)?"light":"night",{like_active:C.value}]),disabled:c.value===null||r.value},[!C.value&&c.value!==null?(p(),z(t(I),{key:0,icon:"icon-park-outline:like",width:"40",height:"40",class:l(t(a)?"input_light":"input_night")},null,8,["class"])):S("",!0),C.value&&c.value!==null?(p(),z(t(I),{key:1,icon:"icon-park-solid:like",width:"40",height:"40",style:{color:"red"}})):S("",!0),c.value!==null?(p(),m("h3",{key:2,class:l(t(a)?"input_light":"input_night")},O(c.value),3)):r.value==!0||c.value==null?(p(),m("div",ee)):S("",!0)],10,Z),i("button",{class:l(["comment",t(a)?"light":"night"]),onClick:e[1]||(e[1]=u=>J(s.postOption.id,s.postOption.user_id))},[h(t(I),{icon:"fa6-solid:comment-dots",width:"40",height:"40",class:l(t(a)?"input_light":"input_night")},null,8,["class"]),A.value!==null?(p(),m("h3",{key:0,class:l(t(a)?"input_light":"input_night")},O(A.value),3)):(p(),m("div",te))],2)]),i("div",se,[i("h2",{class:l(["post_title",t(a)?"input_light":"input_night"])},O(s.postOption.title),3),i("p",oe,O(s.postOption.description),1),i("div",ie,[i("div",le,[i("div",ne,[h(t(R),{to:{name:"userProfile",params:{id:s.postOption.user_id}}},{default:L(()=>[h(E,{src:s.postOption.user_logo,height:"50px",balance:""},null,8,["src"])]),_:1},8,["to"])]),i("div",ae,[h(t(R),{to:{name:"userProfile",params:{id:s.postOption.user_id}}},{default:L(()=>[i("h2",{class:l(t(a)?"input_light":"input_night")},O(s.postOption.user_name),3)]),_:1},8,["to"]),i("h3",{class:l(t(a)?"input_light":"input_night")},O(s.postOption.date),3)])]),i("div",ue,[s.postOption.user_id!==t(v)?(p(),m("button",{key:0,onClick:e[2]||(e[2]=u=>H(s.postOption.user_id)),class:l(["other_subscribe",{hiddenSub:s.subDis}])},[D.value===!0?(p(),m("div",re)):(p(),m("span",ce,O(T.value?"Отписатся":"Подписаться"),1))],2)):S("",!0),i("div",{class:l(["other_icon",{hiddenOther:s.otherDis}])},[i("div",{class:l(["popover_container",t(a)?"themeBgwhite input_light":"themeBgblack input_night",{popover_container_active:P.value}])},[h(t(R),{to:{name:"editPosts",params:{id:s.postOption.id}}},{default:L(()=>[i("button",{class:l(["rename",{disabled_btn:s.postOption.user_id!==t(v)}]),disabled:s.postOption.user_id!==t(v)},[e[6]||(e[6]=M(" Редактировать ")),h(t(I),{icon:"iconamoon:edit-duotone",width:"30",height:"30"})],10,de)]),_:1},8,["to"]),i("button",{class:l(["delete",{disabled_btn:s.postOption.user_id!==t(v)}]),onClick:e[3]||(e[3]=u=>Q(s.postOption.id)),disabled:s.postOption.user_id!==t(v)},[e[7]||(e[7]=M(" Удалить ")),h(t(I),{icon:"icon-park-twotone:delete-four",width:"30",height:"30"})],10,pe)],2),i("button",{class:"btnPopover",onClick:e[4]||(e[4]=u=>K()),onBlur:e[5]||(e[5]=u=>P.value=!1)},[h(t(I),{icon:"iconamoon:menu-kebab-vertical-circle-light",width:"50",height:"50",class:l(t(a)?"input_light":"input_night")},null,8,["class"])],32)],2)])])])],2))}},be=W(ve,[["__scopeId","data-v-9a10075c"]]);export{be as P};
