import{_ as Y,i as k,r as p,u as Z,w as q,o as ee,k as h,a as f,q as b,C as z,b as i,n as l,e,d as M,I,h as A,t as g,D as T,R as V,g as U,j as w}from"./index-BPUFK_9x.js";const te={class:"like_and_comment"},se=["disabled"],oe={key:1,class:"loader"},ie={class:"post_description"},le={class:"post_text"},ae={class:"user_and_other"},ne={class:"user"},ue={class:"logo"},re={class:"logo_name"},ce={class:"other"},de={key:1},pe=["disabled"],he=["disabled"],ve={__name:"Post",props:{postOption:{type:Object,return:!0},userOption:{type:Object,return:!0},subDis:Boolean,otherDis:Boolean},setup(s){const O=s,n=k("theme"),m=k("confirmation"),v=k("user_Id"),x=k("urlAdressAuth"),G=k("urlAdressPosts"),C=k("commentId"),H=k("updateSub"),u=k("media"),P=p(!1),c=p(!1),L=p(null),j=p(!1),R=p(!1),d=p(null),B=p(),$=p([]),_=p([]),S=p(!1),{t:D}=Z(),J=async(a,t,r)=>{c.value=!0;try{if(!v){console.error("UserId не найден в localStorage"),c.value=!1;return}const o=await w.get(`${x}?user_id=${v}`);if(!o.data||!o.data[0]){console.error("Данные пользователя не найдены"),c.value=!1;return}$.value=o.data[0].post_like;const E=$.value.findIndex(y=>y===r);if(E!==-1){$.value.splice(E,1),B.value=t,B.value--,d.value=null;try{const y=await w.put(`${x}/${o.data[0].id}`,{post_like:$.value})}catch(y){console.error("Ошибка при обновлении данных:",y),c.value=!1}}else{$.value.push(r),B.value=t,B.value++,d.value=null;try{const y=await w.put(`${x}/${o.data[0].id}`,{post_like:$.value})}catch(y){console.error("Ошибка при обновлении данных:",y),c.value=!1}}}catch(o){console.error("Ошибка при получении данных пользователя:",o),c.value=!1}try{const o=await w.put(`${G}/${a}`,{like:B.value});c.value=!1,o.status==200&&(m.value.subscribe=!0)}catch(o){console.log(o),c.value=!1}},K=async a=>{R.value=!0;try{if(!v){console.error("UserId не найден в localStorage");return}const t=await w.get(`${x}?user_id=${v}`);if(!t.data||!t.data[0]){console.error("Данные пользователя не найдены");return}_.value=t.data[0].users_subsribe;const r=_.value.findIndex(o=>o===a);if(r!==-1){_.value.splice(r,1);try{const o=await w.put(`${x}/${t.data[0].id}`,{users_subsribe:_.value});_.value=[]}catch(o){console.error("Ошибка при обновлении данных:",o)}}else{_.value.push(a);try{const o=await w.put(`${x}/${t.data[0].id}`,{users_subsribe:_.value});_.value=[]}catch(o){console.error("Ошибка при обновлении данных:",o)}}m.value.subscribe=!0,m.value.subId=O.postOption.image_id}catch(t){console.error("Ошибка при получении данных пользователя:",t)}},N=a=>{const t=O.userOption.post_like.includes(a.image_id);P.value=t,d.value=a.like,L.value=a.comment.length},F=()=>{const a=O.userOption.users_subsribe.includes(O.postOption.user_id);j.value=a,R.value=!1,m.value.subscribe=!1},Q=(a,t)=>{C.value.id=a,C.value.uId=t},W=()=>{S.value=!S.value},X=a=>{m.value.id=a,m.value.deletePost=!0,m.value.active=!0};return q(()=>{H.value===!0&&(F(),N(O.postOption))}),q(()=>{C.value.uId===O.postOption.user_id&&C.value.id===null&&(m.value.subscribe=!0)}),ee(()=>{N(O.postOption),F()}),(a,t)=>(h(),f("section",{class:l(["post_container",e(n)?"themeBgwhite":"themeBgblack"])},[b(z,{src:s.postOption.image,style:{"border-radius":"30px",overflow:"hidden"}},null,8,["src"]),i("div",te,[i("button",{onClick:t[0]||(t[0]=r=>J(s.postOption.id,d.value,s.postOption.image_id)),class:l(["like",e(n)?"light":"night",{like_active:P.value}]),disabled:d.value===null||c.value},[!P.value&&d.value!==null?(h(),M(e(I),{key:0,icon:"icon-park-outline:like",width:e(u)?"25":"40",height:e(u)?"25":"40",class:l(e(n)?"input_light":"input_night")},null,8,["width","height","class"])):A("",!0),P.value&&d.value!==null?(h(),M(e(I),{key:1,icon:"icon-park-solid:like",width:e(u)?"25":"40",height:e(u)?"25":"40",style:{color:"red"}},null,8,["width","height"])):A("",!0),d.value!==null?(h(),f("h3",{key:2,class:l(e(n)?"input_light":"input_night")},g(d.value),3)):c.value==!0||d.value==null?(h(),f("div",{key:3,class:l(e(u)?"loader_text":"loader")},null,2)):A("",!0)],10,se),i("button",{class:l(["comment",e(n)?"light":"night"]),onClick:t[1]||(t[1]=r=>Q(s.postOption.id,s.postOption.user_id))},[b(e(I),{icon:"fa6-solid:comment-dots",width:e(u)?"25":"40",height:e(u)?"25":"40",class:l(e(n)?"input_light":"input_night")},null,8,["width","height","class"]),L.value!==null?(h(),f("h3",{key:0,class:l(e(n)?"input_light":"input_night")},g(L.value),3)):(h(),f("div",oe))],2)]),i("div",ie,[i("h2",{class:l(["post_title",e(n)?"input_light":"input_night"])},g(s.postOption.title),3),i("p",le,g(s.postOption.description),1),i("div",ae,[i("div",ne,[i("div",ue,[b(e(V),{to:{name:"userProfile",params:{id:s.postOption.user_id}}},{default:T(()=>[b(z,{src:s.postOption.user_logo,height:e(u)?"40px":"50px",balance:""},null,8,["src","height"])]),_:1},8,["to"])]),i("div",re,[b(e(V),{to:{name:"userProfile",params:{id:s.postOption.user_id}}},{default:T(()=>[i("h2",{class:l(e(n)?"input_light":"input_night")},g(s.postOption.user_name),3)]),_:1},8,["to"]),i("h3",{class:l(e(n)?"input_light":"input_night")},g(s.postOption.date),3)])]),i("div",ce,[s.postOption.user_id!==e(v)?(h(),f("button",{key:0,onClick:t[2]||(t[2]=r=>K(s.postOption.user_id)),class:l(["other_subscribe",{hiddenSub:s.subDis}])},[R.value===!0?(h(),f("div",{key:0,class:l(e(u)?"loader_text":"loader")},null,2)):(h(),f("span",de,g(j.value?e(D)("post.text1"):e(D)("post.text2")),1))],2)):A("",!0),i("div",{class:l(["other_icon",{hiddenOther:s.otherDis}])},[i("div",{class:l(["popover_container",e(n)?"themeBgwhite input_light":"themeBgblack input_night",{popover_container_active:S.value}])},[b(e(V),{to:{name:"editPosts",params:{id:s.postOption.id}}},{default:T(()=>[i("button",{class:l(["rename",{disabled_btn:s.postOption.user_id!==e(v)}]),disabled:s.postOption.user_id!==e(v)},[U(g(e(D)("post.text3"))+" ",1),b(e(I),{icon:"iconamoon:edit-duotone",width:"30",height:"30"})],10,pe)]),_:1},8,["to"]),i("button",{class:l(["delete",{disabled_btn:s.postOption.user_id!==e(v)}]),onClick:t[3]||(t[3]=r=>X(s.postOption.id)),disabled:s.postOption.user_id!==e(v)},[U(g(e(D)("post.text4"))+" ",1),b(e(I),{icon:"icon-park-twotone:delete-four",width:"30",height:"30"})],10,he)],2),i("button",{class:"btnPopover",onClick:t[4]||(t[4]=r=>W()),onBlur:t[5]||(t[5]=r=>S.value=!1)},[b(e(I),{icon:"iconamoon:menu-kebab-vertical-circle-light",width:e(u)?"40":"50",height:e(u)?"40":"50",class:l(e(n)?"input_light":"input_night")},null,8,["width","height","class"])],32)],2)])])])],2))}},ge=Y(ve,[["__scopeId","data-v-3e6b6d2d"]]);export{ge as P};
